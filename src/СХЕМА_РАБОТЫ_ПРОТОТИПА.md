# 📊 Схема работы прототипа

## 🔄 Полный цикл работы приложения

```
┌─────────────────────────────────────────────────────────────┐
│                    1. ЗАГРУЗКА ПРИЛОЖЕНИЯ                   │
│                                                             │
│  Пользователь → Открывает приложение                        │
│         ↓                                                    │
│  Frontend → Проверяет localStorage для сессии               │
│         ↓                                                    │
│  Результат → Показ страницы входа ИЛИ главной (< 0.1 сек)  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    2. АВТОРИЗАЦИЯ                           │
│                                                             │
│  Пользователь → Вводит email + пароль                       │
│         ↓                                                    │
│  Frontend → Запрос к Supabase Auth (реальный)               │
│         ↓                                                    │
│  Supabase → Проверяет данные, создает токен                 │
│         ↓                                                    │
│  Frontend → Сохраняет токен в localStorage                  │
│         ↓                                                    │
│  Результат → Переход на главную страницу (< 1 сек)          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    3. ЗАГРУЗКА ВИДЕО                        │
│                                                             │
│  Пользователь → Drag & Drop или выбор файла                 │
│         ↓                                                    │
│  Frontend → Валидация (формат, размер, MIME type)           │
│         ↓                                                    │
│  Frontend → Санитизация имени файла                         │
│         ↓                                                    │
│  Результат → Файл готов к анализу (мгновенно)               │
│                                                             │
│  ⚠️ ВАЖНО: Файл НЕ загружается на сервер!                   │
│            Хранится только в памяти браузера                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    4. АНАЛИЗ ВИДЕО                          │
│                                                             │
│  Пользователь → Нажимает "Проанализировать"                 │
│         ↓                                                    │
│  Frontend → Показывает ProcessingPage с анимацией           │
│         ↓                                                    │
│  Frontend → Запускает mock-функцию:                         │
│            • setTimeout(3000) - имитация обработки          │
│            • Возвращает заранее подготовленные данные       │
│         ↓                                                    │
│  Результат → Переход к результатам (через 3 сек)            │
│                                                             │
│  ⚠️ ВАЖНО: НЕТ запросов к backend!                          │
│            НЕТ запросов к Google AI!                        │
│            Всё работает локально в браузере!                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    5. ПОКАЗ РЕЗУЛЬТАТОВ                     │
│                                                             │
│  Frontend → Показывает конфетти (только первый раз)         │
│         ↓                                                    │
│  Frontend → Рендерит 4 блока:                               │
│            • Транскрибация и перевод                        │
│            • 5 ключей к успеху                              │
│            • 5 сцен сценария                                │
│            • 4 рекомендации                                 │
│         ↓                                                    │
│  Результат → Пользователь видит результаты (мгновенно)      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    6. СОХРАНЕНИЕ СЦЕНАРИЯ                   │
│                                                             │
│  Пользователь → Нажимает "Сохранить сценарий"               │
│         ↓                                                    │
│  Frontend → Создает UUID для сценария                       │
│         ↓                                                    │
│  Frontend → Санитизирует данные (XSS protection)            │
│         ↓                                                    │
│  Frontend → Сохраняет в localStorage                        │
│         ↓                                                    │
│  Frontend → Отправляет событие 'scriptsUpdated'             │
│         ↓                                                    │
│  Результат → Счётчик обновляется (< 0.1 сек)                │
│                                                             │
│  ⚠️ ВАЖНО: НЕТ запросов к backend!                          │
│            Данные в localStorage (до 30 сценариев)          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    7. РАБОТА С СОХРАНЁННЫМИ                 │
│                                                             │
│  Пользователь → Открывает вкладку "Сохранённые"             │
│         ↓                                                    │
│  Frontend → Читает из localStorage                          │
│         ↓                                                    │
│  Frontend → Рендерит список сценариев                       │
│         ↓                                                    │
│  Пользователь → Ищет / Копирует / Удаляет                   │
│         ↓                                                    │
│  Frontend → Обновляет localStorage                          │
│         ↓                                                    │
│  Результат → UI обновляется (мгновенно)                     │
│                                                             │
│  ⚠️ ВАЖНО: НЕТ запросов к backend!                          │
│            Всё локально в браузере!                         │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 Архитектура прототипа

```
┌─────────────────────────────────────────────────────┐
│                   FRONTEND ONLY                     │
│                                                     │
│  ┌──────────────┐         ┌──────────────┐         │
│  │   React UI   │ ◄─────► │  localStorage│         │
│  └──────────────┘         └──────────────┘         │
│         │                                           │
│         │ (только Auth)                             │
│         ↓                                           │
│  ┌──────────────┐                                   │
│  │ Supabase Auth│                                   │
│  └──────────────┘                                   │
│                                                     │
└─────────────────────────────────────────────────────┘

❌ НЕ используется:
   - Supabase Storage
   - Supabase Edge Functions
   - Google AI API
   - Backend сервер
```

---

## ⚡ Скорость выполнения

```
Действие                 Время        Что происходит
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Загрузка приложения     < 0.1 сек    Проверка localStorage
Авторизация             ~ 1 сек      Запрос к Supabase Auth
Загрузка видео          Мгновенно    Валидация на фронтенде
Анализ видео            3 сек        setTimeout + mock данные
Показ результатов       Мгновенно    Рендер React компонентов
Сохранение сценария     < 0.1 сек    Запись в localStorage
Открытие сохранённых    < 0.1 сек    Чтение из localStorage
Поиск                   Мгновенно    Фильтрация массива
Копирование             Мгновенно    Clipboard API
Удаление                < 0.1 сек    Обновление localStorage
```

---

## 🔒 Безопасность

```
┌─────────────────────────────────────────────────────┐
│                ЗАЩИТА НА ФРОНТЕНДЕ                  │
│                                                     │
│  1. XSS Protection                                  │
│     └─ Sanitization всех данных                     │
│                                                     │
│  2. MIME Type Validation                            │
│     └─ Проверка типов файлов                        │
│                                                     │
│  3. File Size Limits                                │
│     └─ Максимум 100 МБ                              │
│                                                     │
│  4. Rate Limiting                                   │
│     └─ 50 запросов / 15 минут                       │
│                                                     │
│  5. Input Sanitization                              │
│     └─ Очистка имён файлов                          │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 💾 Хранение данных

```
localStorage Structure:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Key: 'ai_reels_saved_scripts'
Value: Array<SavedScript> (макс. 30)

SavedScript:
{
  id: string (UUID)
  savedAt: string (ISO timestamp)
  title: string
  original: { transcription, translation }
  keys: Array<{ title, description }>
  script: Array<{ time, visual, text, note }>
  recommendations: Array<{ category, text }>
  isDemoMode: boolean
}

Key: 'sb-{projectId}-auth-token'
Value: Supabase auth session
```

---

## 🎯 Преимущества архитектуры

✅ **Скорость:**
- Нет задержек сети
- Всё работает локально
- Мгновенный отклик

✅ **Надёжность:**
- Не зависит от backend
- Работает offline (после первой загрузки)
- Нет точек отказа

✅ **Простота:**
- Легко тестировать
- Легко презентовать
- Не требует настройки

✅ **Масштабируемость:**
- Готов к миграции на backend
- Архитектура не меняется
- Просто раскомментировать код

---

## 🚀 Миграция на production

Когда понадобится реальный анализ:

```
1. Раскомментировать код в /lib/api-supabase.ts
2. Настроить Supabase Edge Functions
3. Добавить Google AI API ключ
4. Настроить Storage Policies
5. Мигрировать localStorage → Supabase DB

Время: ~2 недели разработки + 1 неделя тестирования
```

---

## ✅ Итого

**Прототип - это полноценное приложение:**
- Работает быстро
- Не требует backend
- Готов к презентации
- Легко масштабируется

**Backend можно добавить позже!**
